#!/usr/bin/env bash

clean() { rm -rf /tmp/avfinstall; }

# Install deps
apk add binutils findutils gcc grep iproute2 iptables jq libqrencode \
    musl-dev openrc openssh-server openvpn py2-setuptools python2 \
    python2-dev vim vimdiff wireguard-tools

# Setup install dir
clean
mkdir -p /tmp/avfinstall
cd /tmp/avfinstall

# Install certifyme for OpenVPN
git clone https://gitlab.com/mjwhitta/certifyme.git && \
    (cd certifyme && ./installer)

# Install obfsproxy for OpenVPN
git clone https://github.com/isislovecruft/obfsproxy.git && \
    (cd obfsproxy && python2 ./setup.py install --user)

# Uninstall build deps
apk del gcc musl-dev python2-dev

# Clean up
cd
clean
